name: Build and Release Chrome Extension

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Create extension ZIP
      run: |
        # ë¶ˆí•„ìš”í•œ íŒŒì¼ë“¤ ì œì™¸í•˜ê³  ZIP ìƒì„±
        zip -r chzzk-streamer-blocker.zip . \
          -x "*.git*" \
          -x "*.github*" \
          -x "*.md" \
          -x "*.py" \
          -x "*create_icons*" \
          -x "*.DS_Store*" \
          -x "*.vscode*"
    
    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: |
          ## ğŸš« ì¹˜ì§€ì§ ìŠ¤íŠ¸ë¦¬ë¨¸ ìˆ¨ê¸°ê¸° Chrome Extension
          
          ### âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥
          - Chrome ì›¹ìŠ¤í† ì–´ìš© ë¦´ë¦¬ìŠ¤ ë¹Œë“œ
          
          ### ğŸ“¦ ì„¤ì¹˜ ë°©ë²•
          1. `chzzk-streamer-blocker.zip` ë‹¤ìš´ë¡œë“œ
          2. ì••ì¶• í•´ì œ
          3. Chrome í™•ì¥ í”„ë¡œê·¸ë¨ ê°œë°œì ëª¨ë“œì—ì„œ ë¡œë“œ
          
          ### ğŸ”§ ì§€ì› ì‚¬ì´íŠ¸
          - https://chzzk.naver.com
        draft: false
        prerelease: false
    
    - name: Upload Release Asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./chzzk-streamer-blocker.zip
        asset_name: chzzk-streamer-blocker.zip
        asset_content_type: application/zip